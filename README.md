# FieldForce HRMS - Attendance Break Management

## Project Overview

This project is an extension of the Attendance Module for the FieldForce HRMS SaaS platform. It adds comprehensive "Break Management" capabilities, allowing employees to start and end breaks (lunch, tea, etc.) while capturing location and reason details.

## Features

- **Start Break**: Securely start a break with location tracking.
- **End Break**: End an active break and automatically calculate duration.
- **Break Summary**: Retrieve break history with role-based filtering and nested data structure.
- **Multi-Tenant Support**: Every request is scoped to a specific tenant.
- **Validation**: Strict schema validation for all inputs using Joi.
- **Logging**: Comprehensive system logging using Winston.
- **Documentation**: Auto-generated Swagger/OpenAPI documentation.

## Tech Stack

- **Node.js + Express**
- **PostgreSQL + Sequelize ORM**
- **JWT Authentication**
- **Joi Validation**
- **Winston Logger**
- **Swagger/OpenAPI**

## Prerequisites

- **Node.js**: v14 or higher
- **PostgreSQL**: Local or remote instance
- **Environment variables**: Configured in a `.env` file (see below)

## Setup Instructions

1.  **Clone the repository**:

    ```bash
    git clone https://github.com/the-y0gi/hrms-break-project
    cd hrms-break-project
    ```

2.  **Install dependencies**:

    ```bash
    npm install
    ```

3.  **Environment Variables**:
    Copy the template and update with your database credentials:

    ```bash
    cp .env.example .env
    ```

    Ensure the following variables are set in `.env`:

    ```env
    PORT=3000
    DB_NAME=attendance
    DB_USER=postgres
    DB_PASSWORD=your_password
    DB_HOST=127.0.0.1
    JWT_SECRET=your_jwt_secret
    ```

4.  **Database Setup**:
    - Create a database named `attendance` (or the name you specified in `DB_NAME`) in PostgreSQL.
    - Run migrations to create the necessary tables:

    ```bash
    npm run migrate
    ```

5.  **Run the application**:
    - For Production:
      ```bash
      npm start
      ```
    - For Development (with auto-reload):
      ```bash
      npm run dev
      ```

## Testing & Seed Data

This project includes utility scripts to help you get started quickly:

- **Seed Database**: Generate a test tenant, user, and initial attendance record.

  ```bash
  node seed.js
  ```

  _This will output the `TENANT_ID`, `USER_ID`, and `ATTENDANCE_ID` needed for API requests._

- **Generate Token**: Generate a JWT token for authentication.
  ```bash
  node test-token.js
  ```
  _Note: You may need to edit `test-token.js` to match the IDs generated by the seed script._

## API Documentation

Once the server is running, visit:
`http://localhost:3000/api-docs`

## Scripts

- `npm start`: Starts the server.
- `npm run dev`: Starts the server in watch mode using nodemon.
- `npm run migrate`: Runs database migrations.
- `npm run docs:build`: Re-generates the Swagger documentation.

## Postman Collection

You can use `postman_collection.json` to test the API.
